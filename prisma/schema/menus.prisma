model Menu {
  id        String   @id @default(uuid())
  key       String
  name      Json     @default("{}")
  createdAt DateTime @default(now())
  isActive  Boolean  @default(true)
  updatedAt DateTime @updatedAt

  menuItems MenuItem[]

  storeId String
  store   Store  @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([storeId, key])
  @@index([storeId])
}

model MenuItem {
  id          String   @id @default(uuid())
  key         String
  name        Json     @default("{}")
  createdAt   DateTime @default(now())
  description Json     @default("{}")
  imageUrl    String   @default("/images/IMG_4590.jpg")
  isActive    Boolean  @default(true)
  price       Int
  sold        Int      @default(0)
  stock       Int?
  updatedAt   DateTime @updatedAt

  options             MenuItemOption[]
  menuItemIngredients MenuItemIngredient[]

  menuId String
  menu   Menu   @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@unique([menuId, key])
  @@index([menuId])
}

model MenuItemOption {
  id        String   @id @default(uuid())
  key       String
  name      Json     @default("{}")
  createdAt DateTime @default(now())
  isActive  Boolean  @default(true)
  multiple  Boolean  @default(false)
  required  Boolean  @default(false)
  updatedAt DateTime @updatedAt

  choices MenuItemOptionChoice[]

  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@unique([menuItemId, key])
  @@index([menuItemId])
}

model MenuItemIngredient {
  id        String   @id @default(uuid())
  key       String
  name      Json     @default("{}")
  createdAt DateTime @default(now())
  unit      Json     @default("{}")
  updatedAt DateTime @updatedAt
  usage     Decimal  @db.Decimal(10, 3)

  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@unique([menuItemId, key])
  @@index([menuItemId])
}

model MenuItemOptionChoice {
  id        String   @id @default(uuid())
  key       String
  name      Json     @default("{}")
  createdAt DateTime @default(now())
  extraCost Int      @default(0)
  isActive  Boolean  @default(true)
  isShared  Boolean  @default(false)
  sold      Int      @default(0)
  stock     Int?
  updatedAt DateTime @updatedAt

  menuItemOptionChoiceIngredients MenuItemOptionChoiceIngredient[]

  menuItemOptionId String
  menuItemOption   MenuItemOption @relation(fields: [menuItemOptionId], references: [id], onDelete: Cascade)

  @@unique([menuItemOptionId, key])
  @@index([menuItemOptionId])
}

model MenuItemOptionChoiceIngredient {
  id        String   @id @default(uuid())
  key       String
  name      Json     @default("{}")
  createdAt DateTime @default(now())
  unit      Json     @default("{}")
  updatedAt DateTime @updatedAt
  usage     Decimal  @db.Decimal(10, 3)

  menuItemOptionChoiceId String
  menuItemOptionChoice   MenuItemOptionChoice @relation(fields: [menuItemOptionChoiceId], references: [id], onDelete: Cascade)

  @@unique([menuItemOptionChoiceId, key])
  @@index([menuItemOptionChoiceId])
}
